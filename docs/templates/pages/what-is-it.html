<div class="x-page-content text">

<h1 class="ui dividing header">Wialon API Wrapper</h1>

<p><b>Wrapper API</b> — обёртка над <b>Wialon API</b>. Представлена в виде <b>node.js</b> приложения, которое можно скачать с GitHub <a href='https://github.com/Rulexec/wialon-api-wrapper'>Rulexec/wialon-api-wrapper</a>.</p>

<h2 class="ui header">Зачем?</h2>

<p><b>Wialon API</b> временами необоснованно сложен и разработчики, начинающие с ним работать, сталкиваются с одними и теми же проблемами:</p>

<ul class="x-ul">
	<li>
		<p>error: 4</p>
		<p>Помимо обычных ошибок совсем новичков с <a href='https://url.spec.whatwg.org/#urlencoded-serializing'>x-www-form-urlencoded</a> с неэкранированными амперсандами в параметрах и невалидного JSON'а, иногда эта ошибка происходит из-за не всегда очевидных валидаций. Со временем неочевидностей должно стать меньше, постепенно вводятся поля <b>reason</b> с уточнением ошибки.</p>
	</li>
	<li>
		<p>Сложность входных параметров</p>
		<p>Произвести поиск нужных объектов используя <a href='https://sdk.wialon.com/wiki/en/sidebar/remoteapi/apiref/core/search_items'>core/search_items</a> не такая уж и тривиальная задача. Угадать с первого раза параметры <a href='https://sdk.wialon.com/wiki/en/sidebar/remoteapi/apiref/core/update_data_flags'>core/update_data_flags</a> тоже не всегда получается.</p>
	</li>
	<li>
		<p>Шифрование полей</p>
		<p>Для экономии трафика практически все поля в итоговом JSON'е названы одной-тремя (иногда даже четырьмя) буквами, можно посмотреть пример <a href='https://sdk.wialon.com/wiki/en/sidebar/remoteapi/apiref/format/unit#sensors'>датчика объекта</a>. Без изучения документации часто сложно понять, что есть что.</p>
	</li>
	<li>
		<p>Работа с отчётами</p>
		<p><a href='https://sdk.wialon.com/wiki/en/sidebar/remoteapi/apiref/report/update_report'>Создать отчёт</a> динамически крайне непросто. Отчёт состоит из таблиц, в которых есть колонки, параметры. Некоторые опции отчёта требуют добавления таблиц с определёнными колонками. Со всем этим очень долго разбираться и куда проще создать нужный отчёт руками, экспортировать, а затем программно изменять какие-то его детали, если требуется выполнять множество похожих отчётов автоматически.</p>
		<p>Получить результаты из отчёта так же довольно трудозатратно. Сначала выполняется <a href='https://sdk.wialon.com/wiki/en/sidebar/remoteapi/apiref/report/exec_report'>core/exec_report</a>, затем есть <a href='https://sdk.wialon.com/wiki/en/sidebar/remoteapi/apiref/report/get_result_chart'>report/get_result_chart</a>, <a href='https://sdk.wialon.com/wiki/en/sidebar/remoteapi/apiref/report/get_result_map'>report/get_result_map</a>, <a href='https://sdk.wialon.com/wiki/en/sidebar/remoteapi/apiref/report/render_json'>report/render_json</a>, <a href='https://sdk.wialon.com/wiki/en/sidebar/remoteapi/apiref/report/get_result_subrows'>report/get_result_subrows</a>, <a href='https://sdk.wialon.com/wiki/en/sidebar/remoteapi/apiref/report/select_result_rows'>report/select_result_rows</a>, <a href='https://sdk.wialon.com/wiki/en/sidebar/remoteapi/apiref/report/get_result_rows'>report/get_result_rows</a>, от чего разбегаются глаза и в случае какого-то совсем простого отчёта, где нужно взять пару цифр долго разбираться и выполнять несколько запросов как-то не сильно хочется.</p>
	</li>
</ul>

Данный проект направлен на то, чтобы упростить использование Wialon API насколько это возможно.

<h2>Как?</h2>

<ul class="x-ul">
	<li>
		<p><a href="https://ru.wikipedia.org/wiki/Семантический_URL">Человекопонятные URL'ы</a></p>
		<p>Группировка методов не по <span class="x-code-inline">модуль/метод</span>, а относительно сущностей, над которыми произодятся операции.</p>
	</li>
	<li>
		<p>Уравнивание <a href="/wialon-api/objects">Item'ов и PropItem'ов</a></p>
		<p>Неочевидно, почему данные объектов, пользователей, аккаунтов получаются одним способом, а, например, данные водителей, геозон, уведомлений — другим.</p>
		<p>Детали того, как оно реализовано внутри <b>Wialon</b> вполне можно скрыть и иметь тот же механизм чтения/изменения/удаления для всех сущностей системы.</p>
		<p>Данная абстракция местами будет протекать, когда будут видны ограничения <b>Wialon</b>, когда например, отчёт из одного ресурса не может учитывать сущности из другого, но <b>API</b> будет валидировать такие использования и явно сообщать, что такое кросс-использование в данный момент не поддерживается.</p>
	</li>
	<li>
		<p>Человекопонятные <b>названия полей</b></p>
		<p>JSON это текстовый формат, и если объектов много, а поля называются длиннее, чем данные, которые они содержат — оверхед будет довольно большим.</p>
		<p>Но если нам нужно выполнить несложный запрос, посмотреть на результат глазами, взять нужное значение и вывести на экран, то если для этого требуется каждый раз открывать документацию, значит что-то не так.</p>
		<p>Вполне допустимо отвечать понятными для человека полями, игнорируя оверхед. После того, как использовать <b>API</b> получилось и нужные данные были получены — можно попросить сервер сериализовать данные в <a href="https://developers.google.com/protocol-buffers/">ProtoBuf</a>, где имена полей не присутствуют в сериализованных данных, либо использовать другие варианты уменьшения объёма.</p>
	</li>
	<li>
		<p>Возможность не использовать <b>data flags</b></p>
		<p>Битовые маски удобны для сервера и для сокращения объёмов переданных данных по сети. Но если нужно сделать лишь один запрос — хотелось бы иметь возможность просто перечислить, что конкретно нужно.</p>
		<p>Кроме этого, будет реализована <b>фильтрация данных</b> по указанным полям. Т.е. если вы говорите, что вам нужны только вот эти вот поля — никаких других вы не получите. В случае с флагами <b>Wialon</b> один флаг может отвечать за несколько полей и если добавляется новое, о котором ваше приложение ничего не знает, но оно относится к указанному вами флагу — вы будете его получать.</p>
	</li>
	<li>
		<p>Эволюция <b>API</b></p>
		<p>Фокус данного проекта не на количестве возможностей, которые можно будет совершить при помощи данного <b>API</b>, а на его консистентности и удобстве использования. Поэтому каждый метод обязан быть простым, понятным и удобным.</p>
		<p>Если же что-то всё-таки пойдёт не так, мы снова учтём все накопленные проблемы и начнём версионировать <b>API</b>, выпустив вторую версию, сохраняя работоспособность старых методов настолько долго, насколько это возможно.</p>
	</li>
</ul>

</div>